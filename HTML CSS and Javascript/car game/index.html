<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Lobster', cursive;
    }
    .game {
      background-image: url('bg.jpg');
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }
    .hide {
      display: none;
    }
    .startScreen {
      width: 500px;
      height: auto;
      padding: 20px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      background-color: rgb(43, 205, 226);
      text-align: center;
      border-bottom: 2px solid rgb(132, 197, 197);
    }
    .score,
    .highScore {
      position: absolute;
      top: 10px;
      left: 20px;
      background-color: rgb(100, 224, 156);
      width: 200px;
      color: rgb(59, 40, 40);
      line-height: 40px;
      border-radius: 4px;
      font-size: 1.2em;
      text-align: center;
    }
    .highScore {
      top: 60px;
    }
    .ClickToStart {
      cursor: pointer;
    }
    .gameArea {
      height: 100vh;
      width: 400px;
      margin: auto;
      position: relative;
      background-color: rgb(32, 32, 32);
      overflow: hidden;
      border-left: 4px dashed white;
      border-right: 4px dashed white;
    }
    .car {
      background: url(./images/PlayerCar.png);
      background-repeat: no-repeat;
      background-size: 100% 100%;
      height: 75px;
      width: 50px;
      position: absolute;
      top: 520px;
    }
    .Opponents {
      background: url('opponent%20car.png');
      background-repeat: no-repeat;
      background-size: 100% 100%;
      height: 75px;
      width: 50px;
      position: absolute;
    }
    .roadLines {
      height: 100px;
      width: 10px;
      background-color: white;
      position: absolute;
      margin-left: 195px;
    }
  </style>
</head>
<body>
  <div class="game">
    <div class="score">Score: 0</div>
    <div class="highScore">HighScore: 0</div>
    <div class="startScreen">
      <p class="ClickToStart">Click here to start the game</p>
      <p>INSTRUCTIONS:<br>
        Use Arrow keys to move the car<br>
        If you hit any car then game will end
      </p>
    </div>
    <div class="gameArea"></div>
  </div>
  <script>
    const score = document.querySelector('.score');
    const highScore = document.querySelector('.highScore');
    const startScreen = document.querySelector('.startScreen');
    const gameArea = document.querySelector('.gameArea');
    const ClickToStart = document.querySelector('.ClickToStart');

    let keys = {
      ArrowUp: false,
      ArrowDown: false,
      ArrowLeft: false,
      ArrowRight: false,
    };

    let player = {
      speed: 5,
      score: 0,
      highScore: 0,
      isStart: false
    };

    ClickToStart.addEventListener('click', Start);
    document.addEventListener('keydown', keydown);
    document.addEventListener('keyup', keyup);

    function keydown(e) {
      keys[e.key] = true;
    }

    function keyup(e) {
      keys[e.key] = false;
    }

    function Start() {
      gameArea.innerHTML = "";
      startScreen.classList.add('hide');
      player.isStart = true;
      player.score = 0;
      player.speed = 5;
      window.requestAnimationFrame(Play);

      for (let i = 0; i < 5; i++) {
        let roadLines = document.createElement('div');
        roadLines.setAttribute('class', 'roadLines');
        roadLines.y = (i * 140);
        roadLines.style.top = roadLines.y + "px";
        gameArea.appendChild(roadLines);
      }

      for (let i = 0; i < 3; i++) {
        let opponent = document.createElement('div');
        opponent.setAttribute('class', 'Opponents');
        opponent.y = ((i) * -300);
        opponent.style.top = opponent.y + "px";
        opponent.style.left = Math.floor(Math.random() * 350) + "px";
        opponent.style.backgroundColor = randomColor();
        gameArea.appendChild(opponent);
      }

      let car = document.createElement('div');
      car.setAttribute('class', 'car');
      gameArea.appendChild(car);

      player.x = car.offsetLeft;
      player.y = car.offsetTop;
    }

    function Play() {
      let car = document.querySelector('.car');
      let road = gameArea.getBoundingClientRect();

      if (player.isStart) {
        moveLines();
        moveOpponents(car);

        if (keys.ArrowUp && player.y > (road.top + 70)) player.y -= player.speed;
        if (keys.ArrowDown && player.y < (road.height - 75)) player.y += player.speed;
        if (keys.ArrowRight && player.x < 350) player.x += player.speed;
        if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;

        car.style.top = player.y + "px";
        car.style.left = player.x + "px";

        player.score++;
        player.speed += 0.01;

        if (player.highScore < player.score) player.highScore = player.score;

        score.innerHTML = "Score: " + (player.score);
        highScore.innerHTML = "HighScore: " + (player.highScore);

        window.requestAnimationFrame(Play);
      }
    }

    function moveLines() {
      let roadLines = document.querySelectorAll('.roadLines');
      roadLines.forEach(line => {
        if (line.y >= 700) line.y -= 700;
        line.y += player.speed;
        line.style.top = line.y + "px";
      });
    }

    function moveOpponents(car) {
      let opponents = document.querySelectorAll('.Opponents');
      opponents.forEach(opp => {
        if (isCollide(car, opp)) {
          endGame();
        }
        if (opp.y >= 750) {
          opp.y = -300;
          opp.style.left = Math.floor(Math.random() * 350) + "px";
        }
        opp.y += player.speed;
        opp.style.top = opp.y + "px";
      });
    }

    function isCollide(a, b) {
      let aRect = a.getBoundingClientRect();
      let bRect = b.getBoundingClientRect();
      return !(aRect.bottom < bRect.top ||
               aRect.top > bRect.bottom ||
               aRect.right < bRect.left ||
               aRect.left > bRect.right);
    }

    function endGame() {
      player.isStart = false;
      startScreen.classList.remove('hide');
    }

    function randomColor() {
      function c() {
        let hex = Math.floor(Math.random() * 256).toString(16);
        return ("0" + hex).slice(-2);
      }
      return "#" + c() + c() + c();
    }
  </script>
</body>
</html>
